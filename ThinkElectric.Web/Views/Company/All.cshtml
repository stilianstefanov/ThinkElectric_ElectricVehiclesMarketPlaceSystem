@{
    ViewBag.Title = "Company List";
}

<div class="text-center mt-3">
    <h2>Companies</h2>
</div>

<div class="row">
    <div class="col-md-4">
        <div class="form-group">
            <label for="search">Search:</label>
            <input type="text" class="form-control" id="search" placeholder="Search">
        </div>
    </div>
    <div class="col-md-4">
        <div class="form-group">
            <label for="sort">Sort By:</label>
            <select class="form-control" id="sort">
                <option value="0">Name (Descending)</option>
                <option value="1">Name (Ascending)</option>
                <option value="2">Founded Date (Descending)</option>
                <option value="3">Founded Date (Ascending)</option>
            </select>
        </div>
    </div>
    <div class="col-md-4">
        <div class="form-group">
            <label for="perPage">Companies per Page:</label>
            <select class="form-control" id="perPage">
                <option value="5">5</option>
                <option value="10">10</option>
                <option value="15">15</option>
                <option value="20">20</option>
            </select>
        </div>
    </div>
</div>

<div class="row mt-5" id="companyContainer">
</div>

<div class="text-center mt-5">
    <button type="button" class="btn btn-primary" id="previousPage">Previous</button>
    <button type="button" class="btn btn-primary" id="nextPage">Next</button>
</div>

<script>
    $(document).ready(function () {
      var currentPage = 1; // Initialize current page to 1

      // Initial page load
      loadData();

      // Search input change event
      $('#search').on('input', function () {
        currentPage = 1; // Reset current page to 1
        loadData();
      });

      // Sort dropdown change event
      $('#sort').on('change', function () {
        currentPage = 1; // Reset current page to 1
        loadData();
      });

      // PerPage dropdown change event
      $('#perPage').on('change', function () {
        currentPage = 1; // Reset current page to 1
        loadData();
      });

      // Previous page button click event
      $('#previousPage').on('click', function () {
        if (currentPage > 1) {
          loadData('previous');
        }
      });

      // Next page button click event
      $('#nextPage').on('click', function () {
        loadData('next');
      });

      function loadData(pageDirection) {
        var search = $('#search').val();
        var sort = $('#sort').val();
        var perPage = $('#perPage').val();

        if (pageDirection === 'previous' && currentPage > 1) {
          currentPage--;
        } else if (pageDirection === 'next') {
          currentPage++;
        }

            $.ajax({
                url: '/Company/AllFilteredAndPaged',
                type: 'GET',
                data: {
                    searchTerm: search,
                    companySorting: sort,
                    companiesPerPage: perPage,
                    currentPage: currentPage
                },
                success: function (result) {
                    $('#companyContainer').empty();

                    result.companies.forEach(function (company) {
                        var card = '<div class="col-md-4">' +
                            '<div class="card">' +
                            '<img src="data:' + company.image.imageType + ';base64,' + company.image.data + '" class="image-equal" alt="Company Image">' +
                            '<div class="card-body">' +
                            '<h5 class="card-title">' + company.name + '</h5>' +
                            '<p class="card-text">' +
                            '<strong>Website:</strong> <a href="' + company.website + '" target="_blank">' + company.website + '</a><br>' +
                            '<strong>Founded:</strong> ' + company.foundedDate + '</p>' +
                            '</div>' +
                            '<div class="card-footer d-flex justify-content-center">' +
                            '<div class="btn-group" role="group">' +
                            '<a href="/Company/Details/' + company.id + '" class="btn btn-primary">Details</a>' +
                            '<a href="/Company/Products/' + company.id + '" class="btn btn-secondary ml-5">Products</a>' +
                            '</div>' +
                            '</div>' +
                            '</div></div>';

                        $('#companyContainer').append(card);
                    });

                    // Update previous and next page buttons
                    $('#previousPage').prop('disabled', currentPage === 1);
                    $('#nextPage').prop('disabled', currentPage === result.totalPages);
                },
                error: function (error) {
                    console.log(error);
                }
            });
      }
    });
</script>